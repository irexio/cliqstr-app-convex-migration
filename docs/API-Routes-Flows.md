# Cliqstr API Routes and Flow Documentation

*This file is automatically generated. Last updated: 2025-07-22T16:53:18.416Z*

## API Routes

| Route | Methods | Description |
| ----- | ------- | ----------- |
| `/accept-invite` | POST | 🔐 APA-HARDENED ROUTE: POST /api/accept-invite Purpose: - Accepts an invite using the provided invite code - Adds the current user to the cliq - Marks the invite as used - Handles different invite types (adult vs child) Body Params: - inviteCode: string (required) Returns: - 200 OK with cliqId if successful - 400 if no code is provided - 401 if user is not authenticated - 404 if invite is not found - 410 if invite is already used or expired Security: - Requires user authentication - For child invites, requires adult verification - Enforces APA-compliant access control |
| `/admin/force-password-reset` | POST | Admin API to force password reset for a user POST /api/admin/force-password-reset |
| `/auth/refresh-session` | GET | 🔄 APA-COMPLIANT SESSION REFRESH ENDPOINT |
| `/auth/request-reset` | POST | Allow 1 reset request per 10 minutes per email |
| `/auth/status` | GET | 🔐 APA-HARDENED FALLBACK ROUTE: GET /api/auth/status |
| `/auth/submit-reset` | POST | Audit log |
| `/cliqs/create` | POST | 🔐 APA-HARDENED ROUTE: POST /api/cliqs/create Purpose: - Creates a new cliq for the authenticated user - Adds the creator to the cliq's membership Auth: - Requires valid session (user.id) Body: - name: string - description?: string - privacy: 'private' | 'semi' | 'public' - coverImage?: string (optional; uses default if blank) Returns: - 200 OK + new cliq - 401 if unauthorized - 400 if invalid input - 500 on error |
| `/cliqs/feed` | GET | 🔐 APA-HARDENED ROUTE: GET /api/cliqs/feed?id={cliqId} Purpose: - Returns all active (non-expired) posts and their replies for a specific cliq - Requires that the requester is a member of the cliq Auth: - Validates session with getCurrentUser - Confirms user is a member of the cliq via the membership table Query Params: - id: string (cliqId) — required Output: - Array of posts ordered by `createdAt DESC` - Each post includes: - Author username - Replies ordered ASC - Reply author usernames Notes: - Posts are filtered to only include those with future `expiresAt` - This route intentionally uses query params instead of file-based [id] to avoid Next.js type shadowing bugs Completion: ✅ APA-safe and production-ready as of June 30, 2025 |
| `/cliqs` | GET | 🔐 APA-HARDENED ROUTE: GET /api/cliqs?id={cliqId} Purpose: - Returns public info about a cliq based on the query parameter - Used when viewing cliq details safely without revealing private data Auth: - Requires user to be logged in - Requires user to be a member of the cliq Query Param: - id: string (cliq ID) Returns: - 200 OK with cliq summary info - 401 if unauthenticated or missing cliq ID - 403 if user is not a member of the cliq - 404 if cliq does not exist - 500 on server error |
| `/cliqs/[id]/member-actions` | Unknown | 🔐 APA-HARDENED ROUTE: POST /api/cliqs/[id]/member-actions Purpose: - Allows a user (with proper permissions) to remove, promote, or demote a member. Auth: - Uses getCurrentUser() for session validation - Requires user to be a member of the cliq Body Input: { targetUserId: string, action: 'remove' | 'promote' | 'demote' } Returns: - 200 OK on success - 401 if unauthenticated - 403 if not a member - 400 if invalid input - 500 on DB/server error |
| `/cliqs/[id]/members` | GET | 🔐 APA-HARDENED ROUTE: GET /api/cliqs/[id]/members Purpose: - Returns all members of a cliq (with email + profile) Auth: - Requires user to be a member of the cliq |
| `/cliqs/[id]` | GET, DELETE, PATCH | 🔐 APA-HARDENED ROUTE: GET, PATCH, DELETE /api/cliqs/[id] Purpose: - GET: Fetch cliq metadata (requires membership) - PATCH: Update cliq info (owner only) - DELETE: Soft-delete cliq (owner only) Auth: - All methods use getCurrentUser() - PATCH/DELETE restricted to cliq owner |
| `/complete-approval` | POST | now supports: 'free', 'paid', 'ebt' |
| `/create-checkout-session` | POST | Check if Stripe secret key is available |
| `/create-setup-intent` | POST | 📦 Stripe SetupIntent API — used for adding payment methods |
| `/dev-reset` | GET | No description available |
| `/get-child-info` | POST | Check if Stripe secret key is available |
| `/invite/create` | POST | 🔐 APA-HARDENED — Invite Email Sender & Creator |
| `/invite-request/approve` | POST | 🔐 APA-HARDENED ROUTE: POST /api/invite-request/approve Purpose: - Allows a verified parent or adult to approve a pending invite request (usually submitted by a child user or system-initiated invite) Features: - Authenticates the current user - Ensures only adults (non-child profiles) can approve - Fetches the original inviteRequest by ID - Creates a new invite with `isApproved: true` - Deletes the original pending request Used In: - Parent HQ or email approval flow for child invites - Admin dashboard (future: moderation review tools) Related Routes: - /api/invite/create → creates invite or inviteRequest depending on role - /api/validate-invite → used during sign-up Completion: ✅ Fully live and APA-compliant as of June 30, 2025 |
| `/invites/validate` | GET | ⚠️ DEPRECATED ROUTE: /api/invites/validate This route is deprecated. Please use /api/validate-invite instead. Purpose: - Legacy invite code validation (DEPRECATED) - Use /api/validate-invite for new implementations @deprecated Use /api/validate-invite instead |
| `/parent/approval-complete` | POST | 🔐 APA-HARDENED ROUTE: POST /api/parent/approval-complete |
| `/parent/child/reset-credentials` | POST | POST /api/parent/child/reset-credentials |
| `/parent/child/suspend` | POST | POST /api/parent/child/suspend |
| `/parent/child-credentials/update` | POST | 🔐 APA-HARDENED ROUTE: POST /api/parent/child-credentials/update Purpose: - Allows a parent to set up or update their child's username and password - Part of the APA-compliant flow where parents must create credentials for children - Updates both the user profile (username) and user auth (password) Body Params: - childId: string (required) - The ID of the child user - username: string (required) - The new username for the child - password: string (required) - The new password for the child Returns: - 200 OK if credentials updated successfully - 400 if missing required params - 403 if not authorized (not parent of this child) - 404 if child not found - 500 if server error |
| `/parent/children` | GET | 🔐 APA-HARDENED ROUTE: GET /api/parent/children Purpose: - Returns all child profiles linked to the currently authenticated parent - Used to populate the dropdown in ParentDashboard Auth: - Requires a logged-in parent user (validated via email) - Matches children via ParentLink table (email ↔ childId) Returns: - 200 OK with array of child profiles: [{ id, name?, email? }] - 401 if not authenticated - 500 on server error Used In: - ParentDashboard.tsx (child selector for ParentsHQPage) |
| `/parent/invite-request` | GET | src/app/api/parent/invite-request/route.ts |
| `/parent/pending-children` | GET | GET /api/parent/pending-children |
| `/parent/settings/update` | POST | 🔐 APA-HARDENED ROUTE: POST /api/parent/settings/update Purpose: - Allows verified parents to update permissions and visibility settings for a specific child account they are linked to. Features: - Validates input using Zod - Ensures the parent is authenticated and linked to the child via ParentLink - Updates child settings in the profile table (e.g., invite ability, public cliqs, media access) Used In: - ParentsHQPage (toggle controls and visibility settings) - ParentDashboard wrapper (per-child management UI) Completion: ✅ Fully implemented and APA-compliant as of June 30, 2025 |
| `/parent-approval/complete` | POST | 🔐 APA-HARDENED ROUTE: POST /api/parent-approval/complete Purpose: - Completes the parent approval process - Creates parent account if needed - Links parent to child account - Sets child account to approved - Applies test plan (no Stripe integration) Body Params: - inviteCode: string (required) - childId: string (required) - parentEmail: string (required) - password: string (required) Returns: - 200 OK if approval completed successfully - 400 if missing required params - 404 if invite not found - 500 if server error |
| `/parent-approval/request` | GET, POST | 🔐 APA-HARDENED ROUTE: POST /api/parent-approval/request Purpose: - Handles child sign-up requests that require parent approval - Sends approval email to parent/guardian - Stores pending approval in database Body Params: - childFirstName: string (required) - childBirthdate: string (required) - parentEmail: string (required) Returns: - 200 OK if approval request sent successfully - 400 if missing required fields - 500 if server error Security: - No account created until parent approves - APA-compliant child protection flow |
| `/parent-approval/validate` | GET | 🔐 APA-HARDENED ROUTE: GET /api/parent-approval/validate Purpose: - Validates parent approval request - Returns child information for preview Query Params: - inviteCode: string (required) - childId: string (required) Returns: - 200 OK with child info if valid - 400 if missing required params - 404 if invite not found - 500 if server error |
| `/posts/create` | POST | 🔐 APA-HARDENED ROUTE: POST /api/posts/create Purpose: - Creates a new post inside a specific cliq - Supports optional image and text content - Sets default expiration at 90 days Auth: - Uses getCurrentUser() for session validation Input Body: { content?: string, image?: string (URL), cliqId: string } Returns: - 200 OK + new post - 401 if unauthenticated - 400 if invalid input or missing content - 500 on DB/server error |
| `/red-alert` | POST | POST /api/red-alert |
| `/replies` | POST | 🔐 APA-HARDENED — Create a reply to a post |
| `/resend-verification` | POST | Define validation schema |
| `/reset-password` | POST | 🔐 APA-HARDENED RESET PASSWORD ENDPOINT |
| `/send-parent-email` | POST | 🔐 APA-HARDENED ROUTE: POST /api/send-parent-email 🛠️ INTERNAL USE ONLY Purpose: - Sends parent approval emails for child account creation - Internal helper route for invite flow - Not intended for direct external API calls Tags: Internal, Helper, Email ⚠️ This is an internal helper route - use invite/create instead |
| `/send-reset-email` | POST | API route handler for sending password reset emails Uses the consolidated sendResetEmail helper from lib/auth |
| `/sign-in` | POST | 🔐 APA-SAFE LOGIN ROUTE — FINAL VERSION Authenticates user with email/password, verifies child approval, issues secure session cookie via NextResponse headers. ✅ No persistent tokens used ✅ Role and approval validation ✅ Secure session-based auth only ✅ Legacy tokens cleared |
| `/sign-out` | POST | API Route for signing out users Clears auth_token cookie and any other session data |
| `/sign-up` | POST | 🔐 APA-HARDENED — Sign-Up API Route |
| `/test-email` | GET | Simple test endpoint to verify Resend API is working Access via: /api/test-email?email=your@email.com |
| `/uploadthing` | Unknown | No description available |
| `/user/plan` | POST | API endpoint to save user's plan selection This is called from the choose-plan page For free/test plans, this directly updates the Account record For paid plans, this would normally redirect to Stripe |
| `/validate-invite` | GET | 🔐 APA-HARDENED ROUTE: GET /api/validate-invite Purpose: - Validates an invite code provided in the query string - Confirms the invite exists, is still pending, and is not expired Query Params: - code: string (invite code to validate) Returns: - 200 OK with cliqId, invitedRole, inviterId if valid - 400 if no code is provided - 404 if invite is not found - 410 if invite is already used or expired Used In: - Sign-up and onboarding flow to validate invite links - Early access or referral systems (optional future use) Related Routes: - /api/invite/create → issues new invite codes - /api/invite-request/approve → enables parent approval before invite creation Completion: ✅ Fully live and APA-compliant as of June 30, 2025 |
| `/verify-email` | GET | Email Verification API Endpoint Purpose: - Processes email verification tokens - Marks accounts as verified when users click verification links - Required verification (users must verify before accessing the app) |
| `/webhooks/stripe` | POST | Stripe Webhook API Route This webhook handler processes Stripe events, particularly focusing on payment success to automatically verify user accounts when they make a successful payment. |

## Page Flows

| Page | Redirects To | Description |
| ---- | ------------ | ----------- |
| `/about` | None | No description available |
| `/account` | `/` | 🔐 APA-SAFE — Account settings page (private to the logged-in user) |
| `/admin` | None | Check if user is authenticated and has admin role |
| `/awaiting-approval` | None | No description available |
| `/child/onboarding` | None | Purpose: - Child's first login experience after parent approval - Allows child to set their own nickname (3-20 chars, no profanity) - Parents can view but not control the nickname (APA compliance) - Nickname used in comments, posts, member lists, dashboards Flow: 1. Parent approves child account → child gets login credentials 2. Child logs in for first time → redirected here 3. Child chooses nickname → saved to User.nickname field 4. Child redirected to /my-cliqs-dashboard Database: - Requires User.nickname field (not yet implemented) - Validation: 3-20 chars, letters/numbers/basic symbols, no profanity |
| `/child-account-created` | None | No description available |
| `/choose-plan` | `/sign-in`, `/sign-in`, `/my-cliqs-dashboard` | ✅ Debug: Log user and plan |
| `/cliqs/build` | None | 🛠️ Cliq Builder Page — /cliqs/build Purpose: - Allows users to create a new cliq (name, description, privacy, and banner) - Uses UploadThing for image upload - POSTs to /api/cliqs/create Notes: - Not in a dynamic route, so no ghost fix needed - APA safety is enforced in the backend route |
| `/cliqs/create` | None | 🔐 APA-HARDENED — Create New Cliq Page |
| `/cliqs/feed` | None | 🔐 APA-HARDENED PAGE: /cliqs/feed Purpose: - Renders the logged-in user’s cliq feed - Displays posts that already include author information Auth: - Requires a valid user session - Redirects to 404 if unauthenticated Notes: - Does NOT pass userId to CliqFeed (posts contain their own author info) - Dynamic rendering prevents static caching |
| `/cliqs/[id]/invite` | None | 🔐 APA-HARDENED — Cliq Invite Page - 070325 |
| `/cliqs/[id]/member-actions` | None | 🔐 APA-HARDENED PAGE: /cliqs/[id]/member-actions |
| `/cliqs/[id]/members` | None | 🔐 APA-HARDENED PAGE: /cliqs/[id]/members |
| `/cliqs/[id]` | None | 🔐 APA-Hardened: View Cliq Feed — /cliqs/[id]/page.tsx |
| `/debug/session-check` | None | No description available |
| `/email-confirmation` | None | 🔐 APA-HARDENED — Email Confirmation Page Displayed after adult sign-up to inform users to check their email Part of the APA-compliant adult sign-up flow |
| `/explore` | None | No description available |
| `/faqs` | None | No description available |
| `/features` | None | No description available |
| `/for-parents` | None | No description available |
| `/forgot-password` | None | No description available |
| `/how-it-works` | None | No description available |
| `/invite/accept` | None | 🔐 APA-HARDENED — Invite Acceptance Page 🔄 REDIRECT HELPER This page handles invite acceptance redirects. It receives an invite code via URL query parameter and redirects to the invite page. Tags: Helper, Redirect, Internal Security notes: - No direct account creation happens here - This is just a redirect to the main invite page where proper verification happens - Invite codes are validated server-side |
| `/invite/adult` | None | Validate the invite code when the component mounts |
| `/invite/parent` | None | Validate the invite code when the component mounts |
| `/join` | None | Join Page Purpose: - Landing page when users enter an invite code - Allows existing users to sign in and new users to sign up with pre-filled invite code - Automatically used for "Join a Cliq" flow - Server component that gets invite code from params and passes to client component |
| `/my-cliqs-dashboard` | None | 📂 MyCliqs Dashboard — /my-cliqs-dashboard 🔐 APA-Hardened: Accessible only to logged-in users (child or adult) What this page does: - Displays all cliqs the current user owns or is a member of - Queries both `cliqs` (ownerId) and `memberships` (joined) - Renders a responsive grid of cards (1 mobile • 2 tablet • 3 desktop) - Each card includes: - Banner image (if uploaded) or fallback gradient - Cliq name, privacy level, description - Action buttons: View Cliq • View Members • Invite Someone This page serves as the user's central dashboard and launchpad. It is the starting point for nearly all major actions after login. Used in flows: - Direct sign-up (adult or child) - Post-parent approval (child) - Invited user access |
| `/not-authorized` | None | No description available |
| `/` | None | 🔐 APA-HARDENED by Aiden — public homepage entrypoint |
| `/parent-approval` | None | 🔐 APA-HARDENED — Parent Approval Landing Page |
| `/parents/approval` | None | 🔐 APA-HARDENED — Parent Approval Landing Page |
| `/parents/hq` | None | 🔐 APA-HARDENED ROUTE: /parents-hq Purpose: - Entry point for parents to manage their children’s permissions - Renders <ParentDashboard>, which allows switching between children - Includes toggles, visibility controls, and safe persistence Related: - ParentDashboard.tsx → child picker - ParentsHQPage.tsx → per-child toggle manager - /api/parent/children → fetches child list - /api/parent/settings/update → saves changes |
| `/pricing` | None | No description available |
| `/privacy` | None | No description available |
| `/profile/create` | None | 🔐 APA-HARDENED — Secure Create Profile Page |
| `/profile/edit` | None | 🔐 APA-HARDENED — Edit your profile (private, not public-facing) |
| `/profile` | None | 🔐 APA-HARDENED — Edit Profile Page |
| `/profile/[username]` | None | 🔐 APA-HARDENED PAGE: /profile/[username] |
| `/reset-password` | None | 🔐 APA-HARDENED by Aiden — Password Reset Page |
| `/safety` | None | No description available |
| `/session-ping` | `/sign-in`, `/my-cliqs-dashboard`, `/email-confirmation`, `/choose-plan`, `/choose-plan`, `/my-cliqs-dashboard` | 🔐 APA-HARDENED SESSION PING PAGE |
| `/setup-profile` | None | Purpose: - General profile customization for all users - Profile photo upload, bio, preferences - Different from /child/onboarding (nickname-specific) Note: - Child nickname setup happens at /child/onboarding - This page is for general profile customization |
| `/sign-in` | None | 🔐 APA-HARDENED SIGN-IN PAGE |
| `/sign-up` | None | 🔐 APA-HARDENED SIGN-UP PAGE |
| `/suspended` | None | 🔐 APA SUSPENDED PAGE — shown to users whose accounts are suspended |
| `/terms` | None | No description available |
| `/verification-error` | None | Email Verification Error Page Displayed when there's an issue with email verification |
| `/verification-pending` | None | Retrieve email from localStorage on component mount |
| `/verification-success` | None | Email Verification Success Page Displayed when a user successfully verifies their email address |
| `/verify-card` | `/sign-in` | No description available |
| `/verify-email` | None | Email Verification Page This page handles the verification link from emails It extracts the code from the URL and forwards it to the API |

## Recent Changes

```
7ab557e - Add robust error handling to sign-up API route (3 hours ago)
eed973e - Fix sign-up error handling for adult verification flow (3 hours ago)
fd6e837 - Implement blocking email verification flow for adult users (13 hours ago)
19c29fc - Fix email verification flow and plan banner display (13 hours ago)
df25afc - Fix isApproved field compatibility between User and Account models (14 hours ago)
070510d - Implement APA-compliant parent credential setup flow and consolidate documentation (16 hours ago)
040501f - fix: Resolve foreign key constraint violation in parent approval (2 days ago)
4d8383b - test: Add GET handler to test parent approval API route (2 days ago)
53df548 - debug: Add detailed error logging to parent approval API (2 days ago)
27e9e93 - feat: Add firstName and lastName collection to solve parent identification issue (2 days ago)
```
