# Cliqstr API Routes and Flow Documentation

*This file is automatically generated. Last updated: 2025-07-16T21:20:15.377Z*

## API Routes

| Route | Methods | Description |
| ----- | ------- | ----------- |
| `/admin/force-password-reset` | POST | Admin API to force password reset for a user POST /api/admin/force-password-reset |
| `/auth/refresh-session` | GET | 🔄 APA-COMPLIANT SESSION REFRESH ENDPOINT |
| `/auth/request-reset` | POST | Allow 1 reset request per 10 minutes per email |
| `/auth/status` | GET | 🔐 APA-HARDENED FALLBACK ROUTE: GET /api/auth/status |
| `/auth/submit-reset` | POST | Audit log |
| `/cliqs/create` | POST | 🔐 APA-HARDENED ROUTE: POST /api/cliqs/create Purpose: - Creates a new cliq for the authenticated user - Adds the creator to the cliq's membership Auth: - Requires valid session (user.id) Body: - name: string - description?: string - privacy: 'private' | 'semi' | 'public' - coverImage?: string (optional; uses default if blank) Returns: - 200 OK + new cliq - 401 if unauthorized - 400 if invalid input - 500 on error |
| `/cliqs/feed` | GET | 🔐 APA-HARDENED ROUTE: GET /api/cliqs/feed?id={cliqId} Purpose: - Returns all active (non-expired) posts and their replies for a specific cliq - Requires that the requester is a member of the cliq Auth: - Validates session with getCurrentUser - Confirms user is a member of the cliq via the membership table Query Params: - id: string (cliqId) — required Output: - Array of posts ordered by `createdAt DESC` - Each post includes: - Author username - Replies ordered ASC - Reply author usernames Notes: - Posts are filtered to only include those with future `expiresAt` - This route intentionally uses query params instead of file-based [id] to avoid Next.js type shadowing bugs Completion: ✅ APA-safe and production-ready as of June 30, 2025 |
| `/cliqs` | GET | 🔐 APA-HARDENED ROUTE: GET /api/cliqs?id={cliqId} Purpose: - Returns public info about a cliq based on the query parameter - Used when viewing cliq details safely without revealing private data Auth: - Requires user to be logged in - Requires user to be a member of the cliq Query Param: - id: string (cliq ID) Returns: - 200 OK with cliq summary info - 401 if unauthenticated or missing cliq ID - 403 if user is not a member of the cliq - 404 if cliq does not exist - 500 on server error |
| `/cliqs/[id]/member-actions` | Unknown | 🔐 APA-HARDENED ROUTE: POST /api/cliqs/[id]/member-actions Purpose: - Allows a user (with proper permissions) to remove, promote, or demote a member. Auth: - Uses getCurrentUser() for session validation - Requires user to be a member of the cliq Body Input: { targetUserId: string, action: 'remove' | 'promote' | 'demote' } Returns: - 200 OK on success - 401 if unauthenticated - 403 if not a member - 400 if invalid input - 500 on DB/server error |
| `/cliqs/[id]/members` | GET | 🔐 APA-HARDENED ROUTE: GET /api/cliqs/[id]/members Purpose: - Returns all members of a cliq (with email + profile) Auth: - Requires user to be a member of the cliq |
| `/cliqs/[id]` | GET, DELETE, PATCH | 🔐 APA-HARDENED ROUTE: GET, PATCH, DELETE /api/cliqs/[id] Purpose: - GET: Fetch cliq metadata (requires membership) - PATCH: Update cliq info (owner only) - DELETE: Soft-delete cliq (owner only) Auth: - All methods use getCurrentUser() - PATCH/DELETE restricted to cliq owner |
| `/complete-approval` | POST | now supports: 'free', 'paid', 'ebt' |
| `/create-checkout-session` | POST | Check if Stripe secret key is available |
| `/create-setup-intent` | POST | 📦 Stripe SetupIntent API — used for adding payment methods |
| `/get-child-info` | POST | Check if Stripe secret key is available |
| `/invite/create` | POST | 🔐 APA-HARDENED — Invite Email Sender & Creator |
| `/invite-request/approve` | POST | 🔐 APA-HARDENED ROUTE: POST /api/invite-request/approve Purpose: - Allows a verified parent or adult to approve a pending invite request (usually submitted by a child user or system-initiated invite) Features: - Authenticates the current user - Ensures only adults (non-child profiles) can approve - Fetches the original inviteRequest by ID - Creates a new invite with `isApproved: true` - Deletes the original pending request Used In: - Parent HQ or email approval flow for child invites - Admin dashboard (future: moderation review tools) Related Routes: - /api/invite/create → creates invite or inviteRequest depending on role - /api/validate-invite → used during sign-up Completion: ✅ Fully live and APA-compliant as of June 30, 2025 |
| `/invites/validate` | GET | Invite Code Validation API Purpose: - Validates invite codes - Returns invite metadata for rendering the join page |
| `/parent/approval-complete` | POST | 🔐 APA-HARDENED ROUTE: POST /api/parent/approval-complete |
| `/parent/child/reset-credentials` | POST | POST /api/parent/child/reset-credentials |
| `/parent/child/suspend` | POST | POST /api/parent/child/suspend |
| `/parent/children` | GET | 🔐 APA-HARDENED ROUTE: GET /api/parent/children Purpose: - Returns all child profiles linked to the currently authenticated parent - Used to populate the dropdown in ParentDashboard Auth: - Requires a logged-in parent user (validated via email) - Matches children via ParentLink table (email ↔ childId) Returns: - 200 OK with array of child profiles: [{ id, name?, email? }] - 401 if not authenticated - 500 on server error Used In: - ParentDashboard.tsx (child selector for ParentsHQPage) |
| `/parent/invite-request` | GET | src/app/api/parent/invite-request/route.ts |
| `/parent/pending-children` | GET | GET /api/parent/pending-children |
| `/parent/settings/update` | POST | 🔐 APA-HARDENED ROUTE: POST /api/parent/settings/update Purpose: - Allows verified parents to update permissions and visibility settings for a specific child account they are linked to. Features: - Validates input using Zod - Ensures the parent is authenticated and linked to the child via ParentLink - Updates child settings in the profile table (e.g., invite ability, public cliqs, media access) Used In: - ParentsHQPage (toggle controls and visibility settings) - ParentDashboard wrapper (per-child management UI) Completion: ✅ Fully implemented and APA-compliant as of June 30, 2025 |
| `/posts/create` | POST | 🔐 APA-HARDENED ROUTE: POST /api/posts/create Purpose: - Creates a new post inside a specific cliq - Supports optional image and text content - Sets default expiration at 90 days Auth: - Uses getCurrentUser() for session validation Input Body: { content?: string, image?: string (URL), cliqId: string } Returns: - 200 OK + new post - 401 if unauthenticated - 400 if invalid input or missing content - 500 on DB/server error |
| `/red-alert` | POST | POST /api/red-alert |
| `/replies` | POST | 🔐 APA-HARDENED — Create a reply to a post |
| `/reset-password` | POST | 🔐 APA-HARDENED RESET PASSWORD ENDPOINT |
| `/send-parent-email` | POST | 🔐 APA-HARDENED ROUTE: DO NOT DELETE POST /api/parent/approval-complete Purpose: - Completes a child's signup after parental approval - Hashes password, sets username, sets plan - Creates ParentLink between parent + child - Updates invite status to 'used' - Creates or updates Account with stripeStatus + plan ⚠️ DO NOT IMPORT THIS FILE DIRECTLY |
| `/send-reset-email` | POST | 🔐 APA-HARDENED by Aiden — Password Reset Email Endpoint |
| `/sign-in` | POST | 🔐 APA-SAFE LOGIN ROUTE — FINAL VERSION Authenticates user with email/password, verifies child approval, issues secure session cookie via NextResponse headers. ✅ No persistent tokens used ✅ Role and approval validation ✅ Secure session-based auth only ✅ Legacy tokens cleared |
| `/sign-out` | POST | API Route for signing out users Clears auth_token cookie and any other session data |
| `/sign-up` | POST | 🔐 APA-HARDENED — Sign-Up API Route |
| `/uploadthing` | Unknown | No description available |
| `/user/plan` | POST | API endpoint to save user's plan selection This is called from the choose-plan page For free/test plans, this directly updates the Account record For paid plans, this would normally redirect to Stripe |
| `/validate-invite` | GET | 🔐 APA-HARDENED ROUTE: GET /api/validate-invite Purpose: - Validates an invite code provided in the query string - Confirms the invite exists, is still pending, and is not expired Query Params: - code: string (invite code to validate) Returns: - 200 OK with cliqId, invitedRole, inviterId if valid - 400 if no code is provided - 404 if invite is not found - 410 if invite is already used or expired Used In: - Sign-up and onboarding flow to validate invite links - Early access or referral systems (optional future use) Related Routes: - /api/invite/create → issues new invite codes - /api/invite-request/approve → enables parent approval before invite creation Completion: ✅ Fully live and APA-compliant as of June 30, 2025 |
| `/verify-email` | GET | Email Verification API Endpoint Purpose: - Processes email verification tokens - Marks accounts as verified when users click verification links - Non-blocking verification (users can still access the app before verifying) |
| `/webhooks/stripe` | POST | Stripe Webhook API Route This webhook handler processes Stripe events, particularly focusing on payment success to automatically verify user accounts when they make a successful payment. |

## Page Flows

| Page | Redirects To | Description |
| ---- | ------------ | ----------- |
| `/about` | None | No description available |
| `/account` | `/` | 🔐 APA-SAFE — Account settings page (private to the logged-in user) |
| `/admin` | None | Check if user is authenticated and has admin role |
| `/awaiting-approval` | None | No description available |
| `/child-account-created` | None | No description available |
| `/choose-plan` | `/sign-in`, `/my-cliqs-dashboard`, `/my-cliqs-dashboard` | ✅ Debug: Log user and plan |
| `/cliqs/build` | None | 🛠️ Cliq Builder Page — /cliqs/build Purpose: - Allows users to create a new cliq (name, description, privacy, and banner) - Uses UploadThing for image upload - POSTs to /api/cliqs/create Notes: - Not in a dynamic route, so no ghost fix needed - APA safety is enforced in the backend route |
| `/cliqs/create` | None | 🔐 APA-HARDENED — Create New Cliq Page |
| `/cliqs/feed` | None | 🔐 APA-HARDENED PAGE: /cliqs/feed Purpose: - Renders the logged-in user’s cliq feed - Displays posts that already include author information Auth: - Requires a valid user session - Redirects to 404 if unauthenticated Notes: - Does NOT pass userId to CliqFeed (posts contain their own author info) - Dynamic rendering prevents static caching |
| `/cliqs/[id]/invite` | None | 🔐 APA-HARDENED — Cliq Invite Page - 070325 |
| `/cliqs/[id]/member-actions` | None | 🔐 APA-HARDENED PAGE: /cliqs/[id]/member-actions |
| `/cliqs/[id]/members` | None | 🔐 APA-HARDENED PAGE: /cliqs/[id]/members |
| `/cliqs/[id]` | None | 🔐 APA-Hardened: View Cliq Feed — /cliqs/[id]/page.tsx |
| `/debug/session-check` | None | No description available |
| `/explore` | None | No description available |
| `/faqs` | None | No description available |
| `/features` | None | No description available |
| `/for-parents` | None | No description available |
| `/forgot-password` | None | No description available |
| `/how-it-works` | None | No description available |
| `/join` | None | Join Page Purpose: - Landing page when users enter an invite code - Allows existing users to sign in and new users to sign up with pre-filled invite code - Automatically used for "Join a Cliq" flow - Server component that gets invite code from params and passes to client component |
| `/my-cliqs-dashboard` | None | 📂 MyCliqs Dashboard — /my-cliqs-dashboard 🔐 APA-Hardened: Accessible only to logged-in users (child or adult) What this page does: - Displays all cliqs the current user owns or is a member of - Queries both `cliqs` (ownerId) and `memberships` (joined) - Renders a responsive grid of cards (1 mobile • 2 tablet • 3 desktop) - Each card includes: - Banner image (if uploaded) or fallback gradient - Cliq name, privacy level, description - Action buttons: View Cliq • View Members • Invite Someone This page serves as the user's central dashboard and launchpad. It is the starting point for nearly all major actions after login. Used in flows: - Direct sign-up (adult or child) - Post-parent approval (child) - Invited user access |
| `/not-authorized` | None | No description available |
| `/` | None | 🔐 APA-HARDENED by Aiden — public homepage entrypoint |
| `/parent-approval` | None | 🔐 APA-HARDENED — Parent Approval Landing Page |
| `/parents/approval` | None | 🔐 APA-HARDENED — Parent Approval Landing Page |
| `/parents/hq` | None | 🔐 APA-HARDENED ROUTE: /parents-hq Purpose: - Entry point for parents to manage their children’s permissions - Renders <ParentDashboard>, which allows switching between children - Includes toggles, visibility controls, and safe persistence Related: - ParentDashboard.tsx → child picker - ParentsHQPage.tsx → per-child toggle manager - /api/parent/children → fetches child list - /api/parent/settings/update → saves changes |
| `/pricing` | None | No description available |
| `/privacy` | None | No description available |
| `/profile/create` | None | 🔐 APA-HARDENED — Secure Create Profile Page |
| `/profile/edit` | None | 🔐 APA-HARDENED — Edit your profile (private, not public-facing) |
| `/profile` | None | 🔐 APA-HARDENED — Edit Profile Page |
| `/profile/[username]` | None | 🔐 APA-HARDENED PAGE: /profile/[username] |
| `/reset-password` | None | 🔐 APA-HARDENED by Aiden — Password Reset Page |
| `/safety` | None | No description available |
| `/session-ping` | `/sign-in`, `/my-cliqs-dashboard`, `/my-cliqs-dashboard`, `/choose-plan`, `/choose-plan`, `/my-cliqs-dashboard` | 🔐 APA-HARDENED SESSION PING PAGE |
| `/setup-profile` | None | 🔐 APA-HARDENED PAGE: /setup-profile |
| `/sign-in` | None | 🔐 APA-HARDENED SIGN-IN PAGE |
| `/sign-up` | None | 🔐 APA-HARDENED SIGN-UP PAGE |
| `/suspended` | None | 🔐 APA SUSPENDED PAGE — shown to users whose accounts are suspended |
| `/terms` | None | No description available |
| `/verification-error` | None | Email Verification Error Page Displayed when there's an issue with email verification |
| `/verification-success` | None | Email Verification Success Page Displayed when a user successfully verifies their email address |
| `/verify-card` | `/sign-in` | No description available |

## Recent Changes

```
d21b935 - Improve choose-plan-form mobile responsiveness and center test plan (9 minutes ago)
d453fc7 - Fix session flow to automatically redirect approved users and test plan users to dashboard (4 hours ago)
1f3736f - Temp: Show only 'Test Plan' in choose-plan form during Stripe setup freeze (4 hours ago)
c092758 - Fix session stability issues: implement hard navigations, standardize session data, loosen frontend plan validations, ensure dynamic rendering (5 hours ago)
3f328c7 - Add diagnostic session check page for debugging authentication issues (6 hours ago)
07728f2 - Fix plan redirect loop with hard reload and session refresh (6 hours ago)
c374057 - Add logging to getCurrentUser to trace session and plan data for redirect debugging (7 hours ago)
909bf43 - Fix client component directive order - move 'use client' before dynamic export (18 hours ago)
6f5837f - Fix dynamic server usage errors by restructuring imports and dynamic exports (18 hours ago)
e708f9a - Add global dynamic configuration to fix Vercel dynamic server usage errors (18 hours ago)
```
