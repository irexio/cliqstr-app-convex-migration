# ğŸ‘¨â€ğŸ‘©â€ï¿½ APA-Flow-Scenarios.md

This file documents all key flows for APA-safe onboarding, invite logic, and current testing-mode overrides for Cliqstr.

________________________________________

## ğŸ” APA Sign-Up & Invite Flow Matrix

| Scenario | Trigger/Action | System Response |
|----------|----------------|-----------------|
| **Adult - Sign Up** | Signs up directly | - role: adult<br>â€¢ Enter First Name & Last Name<br>â€¢ Enter Birthdate<br>â€¢ Send to Temporary Plan Page<br>â€¢ Plan page â€“ Only one plan, no Stripe check, set to free<br>â€¢ Redirect to `/email-confirmation` âœ… |
| **Child - Sign Up** | Signs up directly (rare, uninvited) | - role: child<br>â€¢ Prompt for parent email<br>â€¢ Resend email sent<br>â€¢ Redirect to `/awaiting-approval` ğŸš¨ |
| **Adult - Invite** | Invites someone from dashboard | - Radio select: Invite Adult or Invite Child<br>â€¢ If Invite Child: prompt for child name & parent email<br>â€¢ Sends Resend email to **parent approval screen** (`/parent-approval?inviteCode=...&childId=...`) â€” not `/awaiting-approval` |
| **Child - Invite** | (Only if approved to invite) | - `ChildSettings.canSendInvites = true`<br>â€¢ `inviteRequiresApproval` determines routing:<br>&nbsp;&nbsp;&nbsp;&nbsp;o If true: invite is pending until parent approves<br>&nbsp;&nbsp;&nbsp;&nbsp;o If false: invite is sent immediately |

________________________________________

## ğŸ‘¨â€ğŸ‘©â€ï¿½ Child Sign-Up Flow (Direct or via Invite)

**1. Child fills out:**
â€¢ First name, last name<br>â€¢ Birthdate

**2. System:**
â€¢ Determines age < 18 â†’ role: child<br>â€¢ Prompts for parent email<br>â€¢ Sends Resend email to parent with link to welcome page

**3. Child sees:**
â€¢ `/awaiting-approval`

**4. Parent clicks approval link:**
â€¢ Taken to `/parent-approval?inviteCode=...&childId=...`

**5. Parent sees:**
â€¢ Welcome screen<br>â€¢ Explanation of Cliqstr safety<br>â€¢ Child preview info (first name, age)<br>â€¢ Form: create child username, password, choose test plan âœ…

**6. On submit:**
â€¢ `Account.isApproved = true`<br>â€¢ `ParentLink` is created<br>â€¢ Username and hashed password saved<br>â€¢ Send to Temporary Plan Page<br>â€¢ Plan page â€“ Only one plan, no Stripe check, set to free<br>â€¢ Parent redirected to `/parents-hq`

________________________________________

## ğŸ‘€ Invite Flow Breakdown (APA-Safe)

### **Adult â†’ Child Invite**
â€¢ Invite modal shows: Invite Adult / Invite Child (radio buttons)<br>â€¢ If Invite Child:<br>&nbsp;&nbsp;&nbsp;&nbsp;o Collect:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â–ª Child first name and last name<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â–ª Parent email (**trusted adult contact** â€” must be the legal guardian who approves the invite)<br>&nbsp;&nbsp;&nbsp;&nbsp;o Send Resend email to parent:
  â€œYour child [childName] has been invited by [inviterName] to join their cliq on Cliqstr.â€<br>â€¢ Invite stored with:<br>&nbsp;&nbsp;&nbsp;&nbsp;â–ª `inviteType = child`<br>&nbsp;&nbsp;&nbsp;&nbsp;â–ª `friendFirstName` & `lastName`<br>&nbsp;&nbsp;&nbsp;&nbsp;â–ª `trustedAdultContact`<br>&nbsp;&nbsp;&nbsp;&nbsp;â–ª `inviteNote` (optional)<br>â€¢ An Adult to child invite must always be approved by an adult if under age 17

### **Child â†’ Invite Anyone**
â€¢ Only allowed if:<br>&nbsp;&nbsp;&nbsp;&nbsp;o `ChildSettings.canSendInvites = true`<br>â€¢ Invite requires parent approval if:<br>&nbsp;&nbsp;&nbsp;&nbsp;o `inviteRequiresApproval = true`<br>â€¢ If not required:<br>&nbsp;&nbsp;&nbsp;&nbsp;o Invite is sent normally<br>&nbsp;&nbsp;&nbsp;&nbsp;o Email still routed through Resend for safety tracking

________________________________________

## ğŸš§ Testing-Mode Overrides

â€¢ Stripe is disabled<br>â€¢ All plans are auto-set to `free`<br>â€¢ Plan selection page is skipped<br>â€¢ No redirect to `/choose-plan`<br>â€¢ Signup flows must route directly to:<br>&nbsp;&nbsp;&nbsp;&nbsp;o `/email-confirmation` (for adults during testing)<br>&nbsp;&nbsp;&nbsp;&nbsp;o `/my-cliqs-dashboard` (via email link after confirmation)<br>&nbsp;&nbsp;&nbsp;&nbsp;o `/awaiting-approval` (if underage)<br>&nbsp;&nbsp;&nbsp;&nbsp;o `/parents-hq` after approval

________________________________________

## âœ… TO-DO for Windsurf (Post-DB Reset)

â€¢ Recheck `/sign-up` route logic to ensure test plan is applied<br>â€¢ Redirect adult users to `/email-confirmation` immediately after signup<br>â€¢ Ensure confirmation email links to `/my-cliqs-dashboard`<br>â€¢ Recheck `/parent-approval` to route parent to:<br>&nbsp;&nbsp;&nbsp;&nbsp;o Welcome + child preview<br>&nbsp;&nbsp;&nbsp;&nbsp;o Child username/password setup<br>&nbsp;&nbsp;&nbsp;&nbsp;o Auto-apply test plan<br>&nbsp;&nbsp;&nbsp;&nbsp;o Redirect to `/parents-hq`<br>â€¢ Ensure that `/awaiting-approval` is **only** seen by the child immediately after sign-up<br>â€¢ The Resend email to the parent must link to `/parent-approval?inviteCode=...&childId=...`, **not** to `/awaiting-approval`<br>â€¢ Use this file (`APA-Flow-Scenarios.md`) as source of truth for any changes to invite, sign-up, and approval logic.

________________________________________

*Updated by Mimi & Assistant, July 21, 2025 ğŸ’–*

